<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#007AFF">
    <title>Тудушка - Test</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="frontend/css/main.css">
</head>
<body style="background-color: #F2F2F7;">
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header__title">
                <h1>TUDUSHKA</h1>
            </div>
            <button class="header__profile" id="profileButton" type="button">
                <div class="profile-avatar">
                    <svg class="header__profile-icon" width="24" height="24" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="12" cy="8" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M6.2 19c1.1-2.3 3.5-4 6.8-4s5.7 1.7 6.8 4" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                </div>
            </button>
        </header>

        <!-- Date Tabs -->
        <div class="date-tabs">
            <button class="date-tab date-tab--active" data-period="today">
                Сегодня
            </button>
            <button class="date-tab" data-period="week">
                Неделя
            </button>
            <button class="date-tab" data-period="month">
                Месяц
            </button>
        </div>

        <!-- Main Content -->
        <main class="main" id="mainContent">
            <!-- Home Page - Tasks List -->
            <div class="page" id="homePage">
                <!-- Today View -->
                <div class="today-view" id="todayView">
                    <div class="tasks-container" id="tasksContainer">
                        <!-- Tasks will be rendered here -->
                        <div class="task-item" data-task-id="1">
                            <div class="task-header">
                                <div class="task-priority task-priority--urgent">
                                    Срочно
                                </div>
                                <div class="task-time">
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                        <circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M7 3V7L9.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                    14:30
                                </div>
                                <div class="task-date">
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                        <rect x="2" y="3" width="10" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M5 1V3M9 1V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        <path d="M2 6H12" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                    25 июля 2025
                                </div>
                            </div>
                            
                            <div class="task-content">
                                <h3 class="task-title">Заголовок задачи которую нужно выполнить</h3>
                                <p class="task-description">Описание задачи если есть, Описание задачи если есть, Описание задачи если есть.....</p>
                            </div>
                            
                            <div class="task-footer">
                                <button class="task-complete-btn">
                                    Завершить
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Week View -->
                <div class="week-view" id="weekView">
                    <div class="tasks-container">
                        <!-- Friday -->
                        <div class="day-section">
                            <h3 class="day-header">Пятница: 25 июля 2025</h3>
                            <div class="day-tasks">
                                <div class="task-item" data-task-id="1">
                                    <div class="task-header">
                                        <div class="task-priority task-priority--urgent">
                                            Срочно
                                        </div>
                                        <div class="task-time">
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                                <circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.5"/>
                                                <path d="M7 3V7L9.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                            </svg>
                                            14:30
                                        </div>
                                        <div class="task-date">
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                                <rect x="2" y="3" width="10" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                                <path d="M5 1V3M9 1V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                                <path d="M2 6H12" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                            25 июля 2025
                                        </div>
                                    </div>
                                    
                                    <div class="task-content">
                                        <h3 class="task-title">Заголовок задачи которую нужно выполнить</h3>
                                        <p class="task-description">Описание задачи если есть, Описание задачи если есть, Описание задачи если есть.....</p>
                                    </div>
                                    
                                    <div class="task-footer">
                                        <button class="task-complete-btn">
                                            Завершить
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Saturday -->
                        <div class="day-section">
                            <h3 class="day-header">Суббота: 26 июля 2025</h3>
                            <div class="day-tasks">
                                <div class="task-item" data-task-id="2">
                                    <div class="task-header">
                                        <div class="task-time">
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                                <circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.5"/>
                                                <path d="M7 3V7L9.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                            </svg>
                                            14:30
                                        </div>
                                        <div class="task-date">
                                            <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                                <rect x="2" y="3" width="10" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                                <path d="M5 1V3M9 1V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                                <path d="M2 6H12" stroke="currentColor" stroke-width="1.5"/>
                                            </svg>
                                            26 июля 2025
                                        </div>
                                    </div>
                                    
                                    <div class="task-content">
                                        <h3 class="task-title">Заголовок задачи которую нужно выполнить</h3>
                                        <p class="task-description">Описание задачи если есть, Описание задачи если есть, Описание задачи если есть.....</p>
                                    </div>
                                    
                                    <div class="task-footer">
                                        <button class="task-complete-btn">
                                            Завершить
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sunday - No tasks -->
                        <div class="day-section">
                            <h3 class="day-header">Воскресенье: 27 июля 2025</h3>
                            <div class="no-tasks-message">
                                На этот день задач нет
                            </div>
                        </div>

                        <!-- Monday - No tasks -->
                        <div class="day-section">
                            <h3 class="day-header">Понедельник: 28 июля 2025</h3>
                            <div class="no-tasks-message">
                                На этот день задач нет
                            </div>
                        </div>

                        <!-- Tuesday - No tasks -->
                        <div class="day-section">
                            <h3 class="day-header">Вторник: 29 июля 2025</h3>
                            <div class="no-tasks-message">
                                На этот день задач нет
                            </div>
                        </div>

                        <!-- Wednesday - No tasks -->
                        <div class="day-section">
                            <h3 class="day-header">Среда: 30 июля 2025</h3>
                            <div class="no-tasks-message">
                                На этот день задач нет
                            </div>
                        </div>

                        <!-- Thursday - No tasks -->
                        <div class="day-section">
                            <h3 class="day-header">Четверг: 31 июля 2025</h3>
                            <div class="no-tasks-message">
                                На этот день задач нет
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Month View -->
                <div class="month-view" id="monthView">
                    <div class="month-calendar">
                        <!-- Calendar Header -->
                        <div class="calendar-header">
                            <button class="calendar-nav-btn" id="prevMonth">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <h2 class="calendar-month-year" id="calendarMonthYear">Июль 2025</h2>
                            <button class="calendar-nav-btn" id="nextMonth">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                    <path d="M7.5 5L12.5 10L7.5 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Calendar Grid -->
                        <div class="calendar-grid">
                            <!-- Days of week headers -->
                            <div class="calendar-day-header">Вс</div>
                            <div class="calendar-day-header">Пн</div>
                            <div class="calendar-day-header">Вт</div>
                            <div class="calendar-day-header">Ср</div>
                            <div class="calendar-day-header">Чт</div>
                            <div class="calendar-day-header">Пт</div>
                            <div class="calendar-day-header">Сб</div>
                            
                            <!-- Calendar days will be generated by JavaScript -->
                            <div class="calendar-days" id="calendarDays">
                                <!-- Days will be generated here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Selected Day Tasks -->
                    <div class="selected-day-info" id="selectedDayInfo" style="display: none;">
                        <div class="selected-day-tasks" id="selectedDayTasks">
                            <!-- Tasks for selected day will be shown here -->
                        </div>
                    </div>
                </div>
                
                <!-- Add Task Button -->
                <button class="add-task-btn" id="addTaskBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    Добавить
                </button>
            </div>
        </main>

        <!-- Footer Navigation -->
        <footer class="footer">
            <nav class="footer__nav">
                <a href="#/" class="footer__nav-item footer__nav-item--active" data-page="home">
                    <svg class="footer__nav-icon" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    <span>Главная</span>
                </a>
                <a href="#/ai" class="footer__nav-item" data-page="ai">
                    <svg class="footer__nav-icon" width="24" height="24" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M12 1V3" stroke="currentColor" stroke-width="2"/>
                        <path d="M12 21V23" stroke="currentColor" stroke-width="2"/>
                        <path d="M4.22 4.22L5.64 5.64" stroke="currentColor" stroke-width="2"/>
                        <path d="M18.36 18.36L19.78 19.78" stroke="currentColor" stroke-width="2"/>
                        <path d="M1 12H3" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 12H23" stroke="currentColor" stroke-width="2"/>
                        <path d="M4.22 19.78L5.64 18.36" stroke="currentColor" stroke-width="2"/>
                        <path d="M18.36 5.64L19.78 4.22" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    <span>AI Ассистент</span>
                </a>
                <a href="#/archive" class="footer__nav-item" data-page="archive">
                    <svg class="footer__nav-icon" width="24" height="24" viewBox="0 0 24 24">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2" fill="none"/>
                        <line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/>
                        <line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>
                        <path d="M8 14L12 18L16 14" stroke="currentColor" stroke-width="2" fill="none"/>
                    </svg>
                    <span>Архив</span>
                </a>
            </nav>
        </footer>
    </div>

    <!-- Modal container -->
    <div id="modal-container" class="modal-container"></div>

    <!-- Scripts -->
    <script src="frontend/js/modules/tasks.js"></script>
    <script>
        // Calendar functionality
        const CalendarManager = {
            currentDate: new Date(),
            selectedDate: null,
            tasksData: {
                '2025-07-25': [
                    {
                        id: 1,
                        title: 'Заголовок задачи которую нужно выполнить',
                        description: 'Описание задачи если есть, Описание задачи если есть, Описание задачи если есть.....',
                        time: '14:30',
                        priority: 'urgent'
                    }
                ],
                '2025-07-26': [
                    {
                        id: 2,
                        title: 'Вторая задача',
                        description: 'Описание второй задачи',
                        time: '10:00',
                        priority: 'medium'
                    }
                ]
            },

            init() {
                this.currentDate = new Date(); // Current date
                this.renderCalendar();
                this.setupEventListeners();
            },

            setupEventListeners() {
                const prevBtn = document.getElementById('prevMonth');
                const nextBtn = document.getElementById('nextMonth');

                if (prevBtn) {
                    prevBtn.addEventListener('click', () => {
                        this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                        this.renderCalendar();
                    });
                }

                if (nextBtn) {
                    nextBtn.addEventListener('click', () => {
                        this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                        this.renderCalendar();
                    });
                }
            },

            renderCalendar() {
                const monthYearEl = document.getElementById('calendarMonthYear');
                const calendarDaysEl = document.getElementById('calendarDays');

                if (!monthYearEl || !calendarDaysEl) return;

                // Update month/year header
                const monthNames = ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                    'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'];
                monthYearEl.textContent = `${monthNames[this.currentDate.getMonth()]} ${this.currentDate.getFullYear()}`;

                // Generate calendar days
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - firstDay.getDay());

                let daysHTML = '';
                const today = new Date();

                for (let i = 0; i < 42; i++) { // 6 weeks * 7 days
                    const currentDay = new Date(startDate);
                    currentDay.setDate(startDate.getDate() + i);

                    const isCurrentMonth = currentDay.getMonth() === this.currentDate.getMonth();
                    const isToday = currentDay.toDateString() === today.toDateString();
                    
                    // Format date correctly to avoid timezone issues
                    const year = currentDay.getFullYear();
                    const month = String(currentDay.getMonth() + 1).padStart(2, '0');
                    const day = String(currentDay.getDate()).padStart(2, '0');
                    const dateKey = `${year}-${month}-${day}`;
                    
                    const hasTasks = this.tasksData[dateKey] && this.tasksData[dateKey].length > 0;

                    let classes = ['calendar-day'];
                    if (!isCurrentMonth) classes.push('calendar-day--other-month');
                    if (isToday) classes.push('calendar-day--today');
                    if (hasTasks) classes.push('calendar-day--has-tasks');

                    daysHTML += `
                        <div class="${classes.join(' ')}" data-date="${dateKey}">
                            ${currentDay.getDate()}
                        </div>
                    `;
                }

                calendarDaysEl.innerHTML = daysHTML;

                // Add click listeners to calendar days
                const dayElements = calendarDaysEl.querySelectorAll('.calendar-day');
                dayElements.forEach(dayEl => {
                    dayEl.addEventListener('click', (e) => {
                        const dateAttr = e.target.getAttribute('data-date');
                        if (dateAttr) {
                            this.selectDate(dateAttr);
                        }
                    });
                });
            },

            selectDate(dateString) {
                // Remove previous selection
                const prevSelected = document.querySelector('.calendar-day--selected');
                if (prevSelected) {
                    prevSelected.classList.remove('calendar-day--selected');
                }

                // Add selection to clicked day
                const selectedEl = document.querySelector(`[data-date="${dateString}"]`);
                if (selectedEl) {
                    selectedEl.classList.add('calendar-day--selected');
                }

                this.selectedDate = dateString;
                this.showTasksForDate(dateString);
            },

            showTasksForDate(dateString) {
                const selectedDayInfo = document.getElementById('selectedDayInfo');
                const selectedDayTasks = document.getElementById('selectedDayTasks');

                if (!selectedDayInfo || !selectedDayTasks) return;

                // Parse date correctly - add timezone offset to avoid date shift
                const date = new Date(dateString + 'T12:00:00');
                const monthNames = ['января', 'февраля', 'марта', 'апреля', 'мая', 'июня',
                    'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря'];

                const tasks = this.tasksData[dateString] || [];

                if (tasks.length === 0) {
                    selectedDayTasks.innerHTML = `
                        <div class="no-tasks-message">
                            На этот день задач нет
                        </div>
                    `;
                } else {
                    const tasksHTML = tasks.map(task => `
                        <div class="task-item" data-task-id="${task.id}">
                            <div class="task-header">
                                ${task.priority === 'urgent' ? '<div class="task-priority task-priority--urgent">Срочно</div>' : ''}
                                <div class="task-time">
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                        <circle cx="7" cy="7" r="6" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M7 3V7L9.5 9.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                    ${task.time}
                                </div>
                                <div class="task-date">
                                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                                        <rect x="2" y="3" width="10" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/>
                                        <path d="M5 1V3M9 1V3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                                        <path d="M2 6H12" stroke="currentColor" stroke-width="1.5"/>
                                    </svg>
                                    ${date.getDate()} ${monthNames[date.getMonth()]} ${date.getFullYear()}
                                </div>
                            </div>
                            
                            <div class="task-content">
                                <h3 class="task-title">${task.title}</h3>
                                <p class="task-description">${task.description}</p>
                            </div>
                            
                            <div class="task-footer">
                                <button class="task-complete-btn">
                                    Завершить
                                </button>
                            </div>
                        </div>
                    `).join('');

                    selectedDayTasks.innerHTML = tasksHTML;
                }

                selectedDayInfo.style.display = 'block';
            }
        };

        // Tab switching functionality
        function setupTabSwitching() {
            const tabs = document.querySelectorAll('.date-tab');
            const todayView = document.getElementById('todayView');
            const weekView = document.getElementById('weekView');
            const monthView = document.getElementById('monthView');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('date-tab--active'));
                    
                    // Add active class to clicked tab
                    e.target.classList.add('date-tab--active');
                    
                    // Get the selected period
                    const period = e.target.getAttribute('data-period');
                    
                    // Hide all views first
                    todayView.style.display = 'none';
                    weekView.style.display = 'none';
                    monthView.style.display = 'none';
                    
                    // Show appropriate view
                    if (period === 'today') {
                        todayView.style.display = 'block';
                    } else if (period === 'week') {
                        weekView.style.display = 'block';
                    } else if (period === 'month') {
                        monthView.style.display = 'block';
                        // Initialize calendar if not already done
                        if (!CalendarManager.isInitialized) {
                            CalendarManager.init();
                            CalendarManager.isInitialized = true;
                        }
                    }
                });
            });
        }

        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            // Setup tab switching
            setupTabSwitching();
            
            // Initialize tasks module
            if (window.TasksModule) {
                const tasksModule = new window.TasksModule();
                await tasksModule.init();
            }
        });
    </script>
</body>
</html>